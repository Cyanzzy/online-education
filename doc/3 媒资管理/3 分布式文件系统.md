# 分布式文件系统

> 文件系统

文件系统是负责管理和存储文件的系统软件，操作系统通过文件系统提供的接口去存取文件，用户通过操作系统访问磁盘上的文件  

常见的文件系统：FAT16/FAT32、NTFS、HFS、UFS、APFS、XFS、Ext4等   

> 分布式文件系统

 分布式文件系统（Distributed File System，DFS）是指文件系统管理的物理存储资源不一定直接连接在本地节点上，而是通过计算机网络与节点相连；或是若干不同的逻辑磁盘分区或卷标组合在一起而形成的完整的有层次的文件系统。DFS为分布在网络上任意位置的资源提供一个逻辑上的树形文件系统结构，从而使用户访问分布在网络上的共享文件更加简便。单独的 DFS共享文件夹的作用是相对于通过网络上的其他共享文件夹的访问点

简单来说，一个计算机无法存储海量的文件，通过网络将若干计算机组织起来共同去存储海量的文件，去接收海量用户的请求，这些组织起来的计算机通过网络进行通信  

![](https://cyan-images.oss-cn-shanghai.aliyuncs.com/images/online-education-20230122-64.png)

1. 一台计算机的文件系统处理能力扩充到多台计算机同时处理
2. 一台计算机挂了， 还有另外副本计算机提供数据
3. 每台计算机可以放在不同的地域，这样用户就可以就近访问，提高访问速度

## NFS 网络文件系统

 NFS是基于UDP/IP协议的应用，其实现主要是采用远程过程调用RPC机制，RPC提供了一组与机器、操作系统以及低层传送协议无关的存取远程文件的操作。RPC采用了XDR的支持。XDR是一种与机器无关的数据描述编码的协议，他以独立与任意机器体系结构的格式对网上传送的数据进行编码和解码，支持在异构系统之间数据的传送。 

- 在客户端上映射NFS服务器的驱动器
- 客户端通过万国访问NFS服务器的硬盘完全透明

## GFS 

 GFS是一个可扩展的分布式文件系统，用于大型的、分布式的、对大量数据进行访问的应用。它运行于廉价的普通硬件上，并提供容错功能。它可以给大量的用户提供总体性能较高的服务。 

- GFS采用主从结构，一个GFS集群由一个master和大量的chunkserver组成
- master存储了数据文件的元数据，一个文件被分成了若干块存储在多个chunkserver中
- 用户从master中获取数据元信息，向chunkserver存储数据

## HDFS 

 Hadoop分布式文件系统(HDFS)是指被设计成适合运行在通用硬件(commodity hardware)上的分布式文件系统（Distributed File System）。它和现有的分布式文件系统有很多共同点。但同时，它和其他的分布式文件系统的区别也是很明显的。HDFS是一个高度容错性的系统，适合部署在廉价的机器上。HDFS能提供高吞吐量的数据访问，非常适合大规模数据集上的应用。HDFS放宽了一部分POSIX约束，来实现流式读取文件系统数据的目的。HDFS在最开始是作为Apache Nutch搜索引擎项目的基础架构而开发的。HDFS是Apache Hadoop Core项目的一部分。
HDFS有着高容错性（fault-tolerant）的特点，并且设计用来部署在低廉的（low-cost）硬件上。而且它提供高吞吐量（high throughput）来访问应用程序的数据，适合那些有着超大数据集（large data set）的应用程序。HDFS放宽了（relax）POSIX的要求（requirements）这样可以实现流的形式访问（streaming access）文件系统中的数据。 

- HDFS采用主从结构，一个HDFS集群由一个名称节点和若干数据节点组成
- 名称节点存储数据的元信息，一个完整的数据文件分成若干块存储在数据节点
- 客户端从名称节点获取数据的元信息及数据分块的信息，得到信息客户端即可从数据块来存储数据

# MinIO

### 概述

- 本项目采用MinIO构建分布式文件系统，MinIO是一个非常轻量的服务，可以很简单的和其他应用结合使用。它兼容亚马逊S3云存储服务接口，非常适合于存储大容量非结构化的数据，例如图片、视频、日志文件、备份数据和容器/虚拟机镜像等

- 它的一大特点就是轻量，使用简单、功能强大，支持各种平台，单个文件最大5TB，兼容提供了Java、Python、GO等多版本SDK支持

- 官网：https://min.io/，
- 中文：https://www.minio.org.cn/， http://docs.minio.org.cn/docs/
- MinIO键采用去中心化共享架构，每个节点是对等关系，通过Nginx可对MinIO进行负载均衡访问

> 去中心化

* 在大数据领域，通常的设计理念都是无中心和分布式。MinIO分布式模式可以帮助你搭建一个高可用的对象存储服务，你可以使用这些存储设备，而不用考虑其真是物理位置

它将分布在不同服务器上的多块硬盘组成一个对象存储服务。由于硬盘分布在不同的节点上，分布式MinIO避免了单点故障

MinIO使用纠删码技术来保护数据，它是一种恢复丢失和损坏数据的数学算法，它将数据分块，冗余地分散存储在各个节点的磁盘上，所有可用的磁盘组成一个集合，上图由8块硬盘组成一个集合，当上传一个文件时，会通过纠删码算法计算对文件进行分块存储，除了将文件本身分成4个数据块，还会生成4个校验块，数据块和校验开会分散的存储在这8块硬盘上

使用纠删码的好处是即便丢失一半数量(N/2)的硬盘，仍可以恢复数据。例如上面集合中有4个以内的硬盘损害，仍可保证数据恢复，不影响上传和下载；但如果多余一半的硬盘损坏，则无法恢复。

MinIO下载地址：https://dl.min.io/server/minio/release/

安装完毕后，CMD进入minio.exe所在目录，执行下面的命令，会在D盘创建4个目录，模拟4个硬盘 

```bash
minio.exe server D:\environment\minio\minio-repo\data1 D:\environment\minio\minio-repo\data2 D:\environment\minio\minio-repo\data3 D:\environment\minio\minio-repo\data4
```

- 默认账号密码均为`minioadmin`，访问`localhost:9000`进行登录

-  不过我们这里由于条件有限，所以先不做分布式，修改启动命令 

```bash
minio.exe server d:\minio_data
```

然后创建两个buckets：`mediafiles（普通文件）`、`video（视频文件）`

### SDK

[Java版本MinIO文档](https://docs.min.io/docs/java-client-quickstart-guide.html )

```xml
<dependency>
    <groupId>io.minio</groupId>
    <artifactId>minio</artifactId>
    <version>8.4.3</version>
</dependency>
<dependency>
    <groupId>com.squareup.okhttp3</groupId>
    <artifactId>okhttp</artifactId>
    <version>4.8.1</version>
</dependency>
```

| 参数        | 说明                                          |
| ----------- | --------------------------------------------- |
| Endpoint    | 对象存储服务的URL                             |
| Access  Key | Access  key就像用户ID，可以唯一标识你的账户。 |
| Secret  Key | Secret  key是你账户的密码。                   |

创建测试的bucket，将访问权限改成public





